<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
		<title>OneManager jump page</title>
	</head>
	<body>
		<div id='test1'>
			<a id="direct">No link here!</a><br>
			Pls see the code here
		</div>
		<div id='test2'>	
			Pls see refresh token here
		</div>

		<script>
      			var q = new Array();
			var query = window.location.search.substring(1);
			//document.getElementById('test1').innerHTML=query;
			var vars = query.split("&");
			for (var i=0;i<vars.length;i++) {
				var pair = vars[i].split("=");
				q[pair[0]]=pair[1];
			}
			var url = q['session_state'];
			var code = q['code'];
			if (!!url && !!code) {
				document.getElementById('test1').innerHTML+='<b>Code:</b><div><textarea rows="9" cols="160">'+code+'</textarea></div>';
				document.getElementById('test1').innerHTML+='<p>';
				document.getElementById('test1').innerHTML+='<b>State:</b><div><textarea rows="3" cols="160">'+url+'</textarea></div>';

				var xhr = new XMLHttpRequest();
				xhr.open("POST", 'https://login.microsoftonline.com/common/oauth2/v2.0/token', true);
				xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
				xhr.send('client_id=9b354133-9271-4398-8797-c2c31ab6329f&redirect_uri=https://vanyouseea.github.io/hlh/&client_secret=7TS9.CiIRLJj~6__8G4wG3Sy1cpctyV.Aa&scope=Files.ReadWrite.All%20offline_access&grant_type=authorization_code&code='+code);
				xhr.onload = function() {
				  console.log("HELLO")
				  console.log(this.responseText);
				  var data = JSON.parse(this.responseText);
				  console.log(data);
				  document.getElementById('test2').innerHTML+='<b>Reponse:</b><div><textarea rows="3" cols="160">'+data+'</textarea></div>';

				}
				
			} else {
				var str='Error! 有误！';
				if (!url) str+='No url! url参数为空！';
				else document.getElementById('test1').innerHTML='<a href="'+decodeURIComponent(decodeURIComponent(url))+'">'+decodeURIComponent(decodeURIComponent(url))+'</a><br>';
				if (!code) str+='No code from MS! 微软code为空！';
				document.getElementById('test1').innerHTML+=str+'<br>'+decodeURIComponent(query.replace(/\+/g,'%20'));
				//alert(str);
			}
			
		</script>
	</body>
</html>
